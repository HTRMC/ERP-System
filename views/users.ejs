<!-- views/users.ejs -->
<!DOCTYPE html>
<html>
<head>
  <title>Users</title>
</head>
<body>
  <h1>Users</h1>
  <a href="/dashboard">Back to Dashboard</a>
  <ul>
    <% users.forEach(userToUpdate => { %>
      <li>
        <%= userToUpdate.name %> - <%= userToUpdate.role %>
        <% if (userToUpdate.role_id !== 3 || user.role_id === 3 && userToUpdate.id === user.id) { %>
          <form action="/users/<%= userToUpdate.id %>/permissions" method="post" style="display:inline;">
            <select name="role_id">
              <option value="1" <%= userToUpdate.role_id === 1 ? 'selected' : '' %>>Employee</option>
              <option value="2" <%= userToUpdate.role_id === 2 ? 'selected' : '' %>>Manager</option>
              <option value="3" <%= userToUpdate.role_id === 3 ? 'selected' : '' %>>Admin</option>
            </select>
            <button type="submit">Update</button>
          </form>
        <% } %>
      </li>
    <% }) %>
  </ul>

  <% if (user.role_id === 3) { %>
    <h2>Add New User</h2>
    <% if (error) { %>
      <p style="color: red;"><%= error %></p>
    <% } %>
    <form action="/users/register" method="post">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>
      <label for="password">Password:</label>
      <input type="password" id="password" name="password" required>
      <label for="role_id">Role:</label>
      <select id="role_id" name="role_id">
        <option value="1">Employee</option>
        <option value="2">Manager</option>
        <option value="3">Admin</option>
      </select>
      <button type="submit">Register</button>
    </form>
  <% } %>
</body>
</html>
